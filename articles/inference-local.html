<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Inference: Local mfdr • ncvreg</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Inference: Local mfdr">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ncvreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.16.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ncvreg.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/models.html">Models</a></li>
    <li><a class="dropdown-item" href="../articles/penalties.html">Penalties</a></li>
    <li><a class="dropdown-item" href="../articles/adaptive-rescaling.html">Standardization and adaptive rescaling</a></li>
    <li><a class="dropdown-item" href="../articles/inference-mfdr.html">Inference: Marginal false discovery rates</a></li>
    <li><a class="dropdown-item" href="../articles/inference-local.html">Inference: Local mfdr</a></li>
    <li><a class="dropdown-item" href="../articles/other-cv-criteria.html">Other CV criteria</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/ncvreg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Inference: Local mfdr</h1>
                        <h4 data-toc-skip class="author">Ryan Miller and
Patrick Breheny</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/ncvreg/blob/master/vignettes/articles/inference-local.rmd" class="external-link"><code>vignettes/articles/inference-local.rmd</code></a></small>
      <div class="d-none name"><code>inference-local.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="local-false-discovery-rates">Local False Discovery Rates<a class="anchor" aria-label="anchor" href="#local-false-discovery-rates"></a>
</h2>
<p>Classical, single-feature, hypothesis testing approaches rely upon
tail-area probabilies, or the probability that a test statistic, <span class="math inline">z</span>, exceeds a certain value. In contrast,
<em>local approaches</em> like <a href="https://arxiv.org/abs/1809.05497" class="external-link">local mfdr</a> base inference on
that feature’s specific value value of <span class="math inline">z</span> without considering the hypothetical
possibility of more extreme results.</p>
<p>Local false discovery rates are a Bayesian idea that can be
implemented in large-scale testing situations by using empirical Bayes
methods to obtain estimates of: <span class="math display"> Pr(H_{0j} |
z_j = z)</span></p>
<p>The probability of the <span class="math inline">j^{th}</span> null
hypothesis being true, conditional upon the exact value of the observed
test statistic <span class="math inline">z_j</span>. This probability is
defined as the <em>local false discovery rate</em> for the <span class="math inline">j^{th}</span> feature.</p>
</div>
<div class="section level2">
<h2 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h2>
<p>Using Bayes’ rule, we have</p>
<p><span class="math display">Pr(H_{0j} | z_j = z)  = \frac{\pi_0
f_0(z)}{\pi_0f_0(z) + (1 - \pi_0) f_1(z)}, </span></p>
<p>where <span class="math inline">\pi_0</span> is the prior probability
of a true null hypothesis for the collection of tests, <span class="math inline">f_0</span> is the theoretical density of test
statistics under the null, and <span class="math inline">f_1</span> is
the density of non-null test statistics.</p>
<p>A variety of estimators are possible depending on how one goes about
estimating this mixture of densities. One simple approach, currently
used by <code>ncvreg</code>, is to set <span class="math inline">\pi_0 =
1</span> and to avoid estimating <span class="math inline">f_1</span> by
estimating only the marginal density <span class="math inline">f(z)</span> using a kernel density approach.
Thus:</p>
<p><span class="math display"> \widehat{\text{mfdr}}(z) = \frac{\pi_0
f_0(z)}{\hat{f}(z)}.</span> In situations where <span class="math inline">f_0(z) &gt; \hat{f}(z)</span>, local mfdr estimates
are capped at 1.</p>
</div>
<div class="section level2">
<h2 id="test-statistics">Test Statistics<a class="anchor" aria-label="anchor" href="#test-statistics"></a>
</h2>
<p>For each predictor, <code><a href="../reference/mfdr.html">mfdr()</a></code> constructs a test statistic
based upon the mathematical conditions necessary for that variable to
enter the model characterized by a given value of <span class="math inline">\lambda</span>. For linear regression models, these
statistics have the form:</p>
<p><span class="math display">  z_j = \frac{\mathbf{x}_j^T(\mathbf{y} -
\mathbf{X}_{-j}\mathbf{\beta}_{-j})}{\sigma/\sqrt{n}} </span> The
subscript <span class="math inline">-j</span> indicates the removal of
the <span class="math inline">j^{th}</span> predictor. For logistic and
Cox regression models, these statistics have the form:</p>
<p><span class="math display">  z_j = \frac{u_j+ v_j\beta_j}{\sqrt{v_j}}
</span> Here <span class="math inline">u_j</span> is the unpenalized
score function (ie: the first derivative, with respect to <span class="math inline">\beta_j</span>, of the log-likelihood), and <span class="math inline">v_j</span> is the <span class="math inline">j^{th}</span> diagonal element of the unpenalized
Hessian matrix (ie: the second derivative of the log-likelihood)</p>
<p>Under feature independence, each of these statistics will follow a
standard normal distribution under the null hypothesis of that predictor
being independent of the current model’s residuals. Despite being
derived under independence, <code>mfdr</code> tends to be accurate under
mild to moderate dependence structures, see <a href="https://arxiv.org/abs/1809.05497" class="external-link">Miller and Breheny (2018)</a>
for additional details.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Local mfdr estimates can be obtained via the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">Prostate</span><span class="op">$</span><span class="va">X</span>, <span class="va">Prostate</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda <span class="op">=</span> <span class="fl">0.07</span>,  number <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At lambda=0.0700:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Features satisfying criteria       : 8</span></span>
<span><span class="co">#   Average mfdr among chosen features : 0.592</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#          Estimate       z     mfdr Selected</span></span>
<span><span class="co"># lcavol   0.530785  8.7704  &lt; 1e-04        *</span></span>
<span><span class="co"># svi      0.684680  3.9737 0.010695        *</span></span>
<span><span class="co"># lweight  0.622144  3.7369 0.026104        *</span></span>
<span><span class="co"># lbph     0.038452  1.5077 0.901245        *</span></span>
<span><span class="co"># age     -0.004084 -1.2704 0.926945        *</span></span>
<span><span class="co"># pgg45    0.000000  0.8675 0.951263         </span></span>
<span><span class="co"># gleason  0.000000  0.7467 0.955590         </span></span>
<span><span class="co"># lcp      0.000000 -0.2711 0.964801</span></span></code></pre></div>
<p>The argument <code>number = Inf</code> requests mfdr estimates for
all features, regardless of whether or not they are active in the
specified model. These estimates can be understood by studying the
theoretical null and empirically estimated mixture densities for these
data:</p>
<p><img src="inference-local_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>The feature <code>lcavol</code> has an extremely small estimated mfdr
with a statistic of <span class="math inline">z = 8.77</span>, the
origin of this estimate is apparent when examining the ratio between the
null and mixture densities at <span class="math inline">z = 8.88</span>.
In contrast, the feature <code>lbph</code> has a estimated mfdr of <span class="math inline">0.94</span> with a statistic of <span class="math inline">z = 1.51</span>, this estimated is explained by the
null and mixture densities being similar near <span class="math inline">z = 1.51</span>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Breheny, Ryan Miller, Logan Harris.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Last updated: October 08, 2025</p>
</div>

    </footer>
</div>





  </body>
</html>
