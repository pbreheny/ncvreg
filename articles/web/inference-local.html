<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inference: Local mfdr • ncvreg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Inference: Local mfdr">
<meta property="og:description" content="ncvreg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">ncvreg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.14.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/web/getting-started.html">Getting started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Learn more
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/web/models.html">Models</a>
    </li>
    <li>
      <a href="../../articles/web/penalties.html">Penalties</a>
    </li>
    <li>
      <a href="../../articles/web/adaptive-rescaling.html">Standardization</a>
    </li>
    <li>
      <a href="../../articles/web/inference-mfdr.html">Inference: Marginal false discovery rates</a>
    </li>
    <li>
      <a href="../../articles/web/inference-local.html">Inference: Local mfdr</a>
    </li>
    <li>
      <a href="../../articles/web/other-cv-criteria.html">Other CV criteria</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Functions</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pbreheny/ncvreg" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Inference: Local mfdr</h1>
                        <h4 data-toc-skip class="author">Ryan Miller and
Patrick Breheny</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/ncvreg/blob/HEAD/vignettes/web/inference-local.rmd" class="external-link"><code>vignettes/web/inference-local.rmd</code></a></small>
      <div class="hidden name"><code>inference-local.rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="local-false-discovery-rates">Local False Discovery Rates<a class="anchor" aria-label="anchor" href="#local-false-discovery-rates"></a>
</h2>
<p>Classical, single-feature, hypothesis testing approaches rely upon
tail-area probabilies, or the probability that a test statistic, <span class="math inline">\(z\)</span>, exceeds a certain value. In contrast,
<em>local approaches</em> like <a href="https://arxiv.org/abs/1809.05497" class="external-link">local mfdr</a> base inference on
that feature’s specific value value of <span class="math inline">\(z\)</span> without considering the hypothetical
possibility of more extreme results.</p>
<p>Local false discovery rates are a Bayesian idea that can be
implemented in large-scale testing situations by using empirical Bayes
methods to obtain estimates of: <span class="math display">\[ Pr(H_{0j}
| z_j = z)\]</span></p>
<p>The probability of the <span class="math inline">\(j^{th}\)</span>
null hypothesis being true, conditional upon the exact value of the
observed test statistic <span class="math inline">\(z_j\)</span>. This
probability is defined as the <em>local false discovery rate</em> for
the <span class="math inline">\(j^{th}\)</span> feature.</p>
</div>
<div class="section level2">
<h2 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h2>
<p>Using Bayes’ rule, we have</p>
<p><span class="math display">\[Pr(H_{0j} | z_j = z)  = \frac{\pi_0
f_0(z)}{\pi_0f_0(z) + (1 - \pi_0) f_1(z)}, \]</span></p>
<p>where <span class="math inline">\(\pi_0\)</span> is the prior
probability of a true null hypothesis for the collection of tests, <span class="math inline">\(f_0\)</span> is the theoretical density of test
statistics under the null, and <span class="math inline">\(f_1\)</span>
is the density of non-null test statistics.</p>
<p>A variety of estimators are possible depending on how one goes about
estimating this mixture of densities. One simple approach, currently
used by <code>ncvreg</code>, is to set <span class="math inline">\(\pi_0
= 1\)</span> and to avoid estimating <span class="math inline">\(f_1\)</span> by estimating only the marginal
density <span class="math inline">\(f(z)\)</span> using a kernel density
approach. Thus:</p>
<p><span class="math display">\[ \widehat{\text{mfdr}}(z) = \frac{\pi_0
f_0(z)}{\hat{f}(z)}.\]</span> In situations where <span class="math inline">\(f_0(z) &gt; \hat{f}(z)\)</span>, local mfdr
estimates are capped at 1.</p>
</div>
<div class="section level2">
<h2 id="test-statistics">Test Statistics<a class="anchor" aria-label="anchor" href="#test-statistics"></a>
</h2>
<p>For each predictor, <code><a href="../../reference/mfdr.html">mfdr()</a></code> constructs a test statistic
based upon the mathematical conditions necessary for that variable to
enter the model characterized by a given value of <span class="math inline">\(\lambda\)</span>. For linear regression models,
these statistics have the form:</p>
<p><span class="math display">\[  z_j = \frac{\mathbf{x}_j^T(\mathbf{y}
- \mathbf{X}_{-j}\mathbf{\beta}_{-j})}{\sigma/\sqrt{n}} \]</span> The
subscript <span class="math inline">\(-j\)</span> indicates the removal
of the <span class="math inline">\(j^{th}\)</span> predictor. For
logistic and Cox regression models, these statistics have the form:</p>
<p><span class="math display">\[  z_j = \frac{u_j+
v_j\beta_j}{\sqrt{v_j}} \]</span> Here <span class="math inline">\(u_j\)</span> is the unpenalized score function
(ie: the first derivative, with respect to <span class="math inline">\(\beta_j\)</span>, of the log-likelihood), and
<span class="math inline">\(v_j\)</span> is the <span class="math inline">\(j^{th}\)</span> diagonal element of the
unpenalized Hessian matrix (ie: the second derivative of the
log-likelihood)</p>
<p>Under feature independence, each of these statistics will follow a
standard normal distribution under the null hypothesis of that predictor
being independent of the current model’s residuals. Despite being
derived under independence, <code>mfdr</code> tends to be accurate under
mild to moderate dependence structures, see <a href="https://arxiv.org/abs/1809.05497" class="external-link">Miller and Breheny (2018)</a>
for additional details.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Local mfdr estimates can be obtained via the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">Prostate</span><span class="op">$</span><span class="va">X</span>, <span class="va">Prostate</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda <span class="op">=</span> <span class="fl">0.07</span>,  number <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At lambda=0.0700:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Features satisfying criteria       : 8</span></span>
<span><span class="co">#   Average mfdr among chosen features : 0.592</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#          Estimate       z     mfdr Selected</span></span>
<span><span class="co"># lcavol   0.530785  8.7704  &lt; 1e-04        *</span></span>
<span><span class="co"># svi      0.684680  3.9737 0.010695        *</span></span>
<span><span class="co"># lweight  0.622144  3.7369 0.026104        *</span></span>
<span><span class="co"># lbph     0.038452  1.5077 0.901245        *</span></span>
<span><span class="co"># age     -0.004084 -1.2704 0.926945        *</span></span>
<span><span class="co"># pgg45    0.000000  0.8675 0.951263         </span></span>
<span><span class="co"># gleason  0.000000  0.7467 0.955590         </span></span>
<span><span class="co"># lcp      0.000000 -0.2711 0.964801</span></span></code></pre></div>
<p>The argument <code>number = Inf</code> requests mfdr estimates for
all features, regardless of whether or not they are active in the
specified model. These estimates can be understood by studying the
theoretical null and empirically estimated mixture densities for these
data:</p>
<p><img src="inference-local_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>The feature <code>lcavol</code> has an extremely small estimated mfdr
with a statistic of <span class="math inline">\(z = 8.77\)</span>, the
origin of this estimate is apparent when examining the ratio between the
null and mixture densities at <span class="math inline">\(z =
8.88\)</span>. In contrast, the feature <code>lbph</code> has a
estimated mfdr of <span class="math inline">\(0.94\)</span> with a
statistic of <span class="math inline">\(z = 1.51\)</span>, this
estimated is explained by the null and mixture densities being similar
near <span class="math inline">\(z = 1.51\)</span>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Patrick Breheny.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
