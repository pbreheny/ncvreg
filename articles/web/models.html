<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Models â€¢ ncvreg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Models">
<meta property="og:description" content="ncvreg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">ncvreg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.14.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/web/getting-started.html">Getting started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Learn more
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/web/models.html">Models</a>
    </li>
    <li>
      <a href="../../articles/web/penalties.html">Penalties</a>
    </li>
    <li>
      <a href="../../articles/web/adaptive-rescaling.html">Standardization</a>
    </li>
    <li>
      <a href="../../articles/web/inference-mfdr.html">Inference: Marginal false discovery rates</a>
    </li>
    <li>
      <a href="../../articles/web/inference-local.html">Inference: Local mfdr</a>
    </li>
    <li>
      <a href="../../articles/web/other-cv-criteria.html">Other CV criteria</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Functions</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pbreheny/ncvreg" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Models</h1>
                        <h4 data-toc-skip class="author">Patrick
Breheny</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/ncvreg/blob/HEAD/vignettes/web/models.rmd" class="external-link"><code>vignettes/web/models.rmd</code></a></small>
      <div class="hidden name"><code>models.rmd</code></div>

    </div>

    
    
<p><code>ncvreg</code> fits models that fall into the penalized
likelihood framework. Rather than estimating <span class="math inline">\(\bb\)</span> by maximizing the likelihood, in this
framework we estimate <span class="math inline">\(\bb\)</span> by
minimizing the objective function <span class="math display">\[
Q(\bb|\X, \y) = \frac{1}{n}L(\bb|\X,\y) + P_\lam(\bb),
\]</span> where the loss function <span class="math inline">\(L(\bb|\X,\y)\)</span> is the deviance (<span class="math inline">\(-2\)</span> times the log-likelihood), <span class="math inline">\(P_\lam(\bb)\)</span> is the penalty, and <span class="math inline">\(\lam\)</span> is a regularization parameter that
controls the tradeoff between the two components. This article describes
the different loss models available in <code>ncvreg</code>; see <a href="penalties.html">penalties</a> for more information on the
different penalties available.</p>
<div class="section level2">
<h2 id="gaussian-linear-regression">Gaussian (linear regression)<a class="anchor" aria-label="anchor" href="#gaussian-linear-regression"></a>
</h2>
<p>In linear regression, the loss function is simply the squared error
loss: <span class="math display">\[
L(\bb|\X,\y) = \norm{\y-\X\bb}_2^2;
\]</span> this loss is proportional to the deviance if the outcome <span class="math inline">\(\y\)</span> follows a normal distribution with
constant variance and mean given by <span class="math inline">\(\X\bb\)</span>.</p>
<p>In the <code>Prostate</code> data packaged with <code>ncvreg</code>,
the response is the prostate specific antigen (PSA), measured on the log
scale, and follows an approximate normal distribution; see
<code><a href="../../reference/Prostate.html">?Prostate</a></code> for more information on the data set. Loading
this data set into R,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Prostate</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Prostate</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Prostate</span><span class="op">$</span><span class="va">y</span></span></code></pre></div>
<p>By default, <code>ncvreg</code> fits a linear regression model with a
minimax concave penalty (MCP):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>This produces a path of coefficient estimates, which we can plot
with</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/fit-linear-1.png" width="480"></p>
<p>Although the least squares loss function is convex, the MCP penalty
is not. The resulting objective function, therefore, may or may not be
convex. <code>ncvreg</code> uses a local convexity diagnostic, as
described in <a href="https://myweb.uiowa.edu/pbreheny/pdf/Breheny2011.pdf" class="external-link">Breheny and
Huang (2011)</a>, to identify the regions of the coefficient path where
the objective function is not convex; this is the gray shaded region in
the plot. Users should be aware that solutions in this region may only
be local optima of the objective function, not global ones.</p>
<p>Post-selection inference is available using the <code>summary</code>
method:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At lambda=0.0500:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   6</span></span>
<span><span class="co">#   Expected nonzero coefficients:   2.54</span></span>
<span><span class="co">#   Average mfdr (6 features)    :   0.424</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#         Estimate      z     mfdr Selected</span></span>
<span><span class="co"># lcavol   0.53179  8.880  &lt; 1e-04        *</span></span>
<span><span class="co"># svi      0.67256  3.945 0.010189        *</span></span>
<span><span class="co"># lweight  0.60390  3.666 0.027894        *</span></span>
<span><span class="co"># lbph     0.08875  1.928 0.773014        *</span></span>
<span><span class="co"># age     -0.01531 -1.788 0.815269        *</span></span>
<span><span class="co"># pgg45    0.00168  1.160 0.917570        *</span></span></code></pre></div>
<p>The local marginal false discovery rate (mfdr) is given for each of
the selected features. Roughly, this corresponds to the probability that
the given feature is marginally independent of the residuals at that
value of <span class="math inline">\(\lam\)</span>. In this case, it
would appear that <code>lcavol</code>, <code>svi</code>, and
<code>lweight</code> are clearly associated with the response, even
after adjusting for the other variables in the model, while
<code>lbph</code>, <code>age</code>, and <code>pgg45</code> may be false
positives selected simply by chance. For more information on
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and its various options, see <a href="inference-local.html">here</a>.</p>
<p>Typically, one would carry out cross-validation for the purposes of
assessing the predictive accuracy of the model at various values of
<span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/cv.ncvreg.html">cv.ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>By default, the cross-validation error (CVE) is plotted; for all
models in <code>ncvreg</code>, the cross-validation error is defined as
<span class="math display">\[
\begin{align*}
\CVE(\lam) &amp;= \frac{1}{n} \sum_i L\{y_i, \eta_{-i}(\lam)\}\\
\eta_{-i}(\lam) &amp;= \sum_j x_{ij}\bh_j(-i,\lam),
\end{align*}
\]</span> where <span class="math inline">\(\bbh(-i,\lam)\)</span>
denotes the estimated regression coefficients at <span class="math inline">\(\lam\)</span> for the fold in which observation
<span class="math inline">\(i\)</span> has been left out. The loss
function is determined by the type of model; for least squares loss,
therefore, <span class="math display">\[
\CVE(\lam) = \frac{1}{n} \sum_i\{y_i-\eta_{-i}(\lam)\}^2\\
\]</span></p>
<p>Alternatively, one can plot <span class="math inline">\(\hat{\sigma}(\lam)\)</span>, the signal-to-noise
ration (SNR), or <span class="math inline">\(R^2\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'cve'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'scale'</span><span class="op">)</span>  <span class="co"># sigma hat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'snr'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'rsq'</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>Calling <code>summary</code> on a <code>cv.ncvreg</code> object will
provide a summary of these quantities at the value which minimizes <span class="math inline">\(\CVE\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At minimum cross-validation error (lambda=0.0104):</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients: 8</span></span>
<span><span class="co">#   Cross-validation error (deviance): 0.59</span></span>
<span><span class="co">#   R-squared: 0.55</span></span>
<span><span class="co">#   Signal-to-noise ratio: 1.22</span></span>
<span><span class="co">#   Scale estimate (sigma): 0.771</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At lambda=0.0104:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   8</span></span>
<span><span class="co">#   Expected nonzero coefficients:   4.06</span></span>
<span><span class="co">#   Average mfdr (8 features)    :   0.507</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#          Estimate       z     mfdr Selected</span></span>
<span><span class="co"># lcavol   0.564364  8.4578  &lt; 1e-04        *</span></span>
<span><span class="co"># svi      0.761619  4.0093 0.006833        *</span></span>
<span><span class="co"># lweight  0.621983  3.3883 0.057746        *</span></span>
<span><span class="co"># age     -0.021247 -2.0114 0.697464        *</span></span>
<span><span class="co"># lcp     -0.106038 -1.8854 0.746320        *</span></span>
<span><span class="co"># lbph     0.096715  1.7841 0.779670        *</span></span>
<span><span class="co"># pgg45    0.004459  1.5989 0.828584        *</span></span>
<span><span class="co"># gleason  0.049149  0.4515 0.939912        *</span></span></code></pre></div>
<p>To access the elements of the fit, <code>coef</code> and
<code>predict</code> methods are provided. For example,
<code>coef(fit, lambda=0.02)</code> returns the estimated coefficients
at <span class="math inline">\(\lambda\)</span>=0.02, while
<code>coef(cvfit)</code> returns the estimated coefficients at the value
of <span class="math inline">\(\lam\)</span> minimizing CVE.</p>
</div>
<div class="section level2">
<h2 id="binomial-logistic-regression">Binomial (logistic regression)<a class="anchor" aria-label="anchor" href="#binomial-logistic-regression"></a>
</h2>
<p>In logistic regression, the loss function is: <span class="math display">\[
L(\bb|\X,\y) = -2\sum_{i:y_i=1}\log\ph_i - 2\sum_{i:y_i=0}\log(1-\ph_i);
\]</span> this loss is the deviance for a binomial distribution with
probabilities <span class="math inline">\(P(Y_i=1)=\ph_i\)</span> given
by: <span class="math display">\[
\ph_i = \frac{\exp(\eta_i)}{1+\eta_i},
\]</span> where <span class="math inline">\(\be = \X\bb\)</span> denotes
the linear predictors. The <code>Heart</code> data provides an example
of data that can be used with logistic regression. Loading this data set
into R,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Heart</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Heart</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Heart</span><span class="op">$</span><span class="va">y</span></span></code></pre></div>
<p>One can change the loss function by specifying <code>family</code>;
to fit a penalized logistic regression model,</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, family<span class="op">=</span><span class="st">'binomial'</span><span class="op">)</span></span></code></pre></div>
<p>As before, you can call <code>plot</code>, <code>coef</code>,
<code>predict</code>, <code>summary</code>, etc. on
<code>fit</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized logistic regression with n=462, p=9</span></span>
<span><span class="co"># At lambda=0.0200:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   7</span></span>
<span><span class="co">#   Expected nonzero coefficients:   1.90</span></span>
<span><span class="co">#   Average mfdr (7 features)    :   0.271</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#           Estimate       z      mfdr Selected</span></span>
<span><span class="co"># age      0.0506911  5.8368   &lt; 1e-04        *</span></span>
<span><span class="co"># famhist  0.9096673  4.1177 0.0024258        *</span></span>
<span><span class="co"># tobacco  0.0802204  3.3117 0.0443510        *</span></span>
<span><span class="co"># typea    0.0370468  3.1833 0.0656364        *</span></span>
<span><span class="co"># ldl      0.1657752  3.1019 0.0831088        *</span></span>
<span><span class="co"># obesity -0.0087180 -1.2579 0.8340700        *</span></span>
<span><span class="co"># sbp      0.0001648  0.9981 0.8707837        *</span></span></code></pre></div>
<p>Cross-validation is similar, although (a) there is a new option,
<code>type='pred'</code> for cross-validated prediction error
(misclassification error) and (b) <code>type='scale'</code> is no longer
an option:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/cv.ncvreg.html">cv.ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, family<span class="op">=</span><span class="st">'binomial'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'all'</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-10-1.png" width="480"></p>
<p>Note that, as defined above, cross-validation error is the
cross-validated deviance. At its optmium, the penalized logistic
regression model can predict about 73% of coronary heart disease cases
correctly (27% misclassification).</p>
</div>
<div class="section level2">
<h2 id="poisson">Poisson<a class="anchor" aria-label="anchor" href="#poisson"></a>
</h2>
<p>In Poisson regression, the loss function is: <span class="math display">\[
L(\bb|\X,\y) = 2\sum_i \left\{y_i\log y_i - y_i\log \mu_i + mu_i -
y_i\right\};
\]</span> note that some of these terms are constant with respect to
<span class="math inline">\(\mu_i\)</span> and can therefore be ignored
during optimization. This loss is the deviance for a Poisson
distribution <span class="math inline">\(Y_i \sim
\text{Pois}(\mh_i)\)</span> with rate parameter given by: <span class="math display">\[
\mh_i = \exp(\eta_i).
\]</span> To fit a penalized Poisson regression model with
<code>ncvreg</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, family<span class="op">=</span><span class="st">'poisson'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cox-proportional-hazards">Cox proportional hazards<a class="anchor" aria-label="anchor" href="#cox-proportional-hazards"></a>
</h2>
<p>The above models all fall into the category of distributions known as
exponential families (hence the <code>family</code>) argument.
<code>ncvreg</code> also allows users to fit Cox proportional hazards
models, although these models fall outside this framework and are
therefore fit using a different function, <code>ncvsurv</code>. In Cox
regression, the deviance is <span class="math display">\[
L(\bb|\X,\y) = -2\sum_{j=1}^{m} d_j \eta_j + 2\sum_{j=1}^{m} d_j
\log\left\{\sum_{i \in R_j} \exp(\eta_i)\right\},
\]</span> where <span class="math inline">\(t_1 &lt; t_2 &lt; \ldots
&lt; t_m\)</span> denotes an increasing list of unique failure times
indexed by <span class="math inline">\(j\)</span> and <span class="math inline">\(R_j\)</span> denotes the set of observations still
at risk at time <span class="math inline">\(t_j\)</span>, known as the
risk set.</p>
<p>The <code>Lung</code> data (see <code><a href="../../reference/Lung.html">?Lung</a></code> for more details)
provides an example of time-to-event data that can be used with Cox
regression. Loading this data set into R,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Lung</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Lung</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Lung</span><span class="op">$</span><span class="va">y</span></span></code></pre></div>
<p>To fit a penalized Cox regression model,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/ncvsurv.html">ncvsurv</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>As before, you can call <code>plot</code>, <code>coef</code>,
<code>predict</code>, <code>summary</code>, etc. on
<code>fit</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized Cox regression with n=137, p=8</span></span>
<span><span class="co"># At lambda=0.0200:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   7</span></span>
<span><span class="co">#   Expected nonzero coefficients:   4.59</span></span>
<span><span class="co">#   Average mfdr (7 features)    :   0.656</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#           Estimate       z     mfdr Selected</span></span>
<span><span class="co"># karno    -0.032745 -6.5040  &lt; 1e-04        *</span></span>
<span><span class="co"># squamous -0.853399 -3.7843 0.026061        *</span></span>
<span><span class="co"># large    -0.460405 -2.0522 0.806970        *</span></span>
<span><span class="co"># trt       0.294489  1.5967 0.905628        *</span></span>
<span><span class="co"># adeno     0.324743  1.3941 0.928532        *</span></span>
<span><span class="co"># age      -0.008869 -1.0297 0.952846        *</span></span>
<span><span class="co"># prior     0.033326  0.3585 0.969878        *</span></span></code></pre></div>
<p>Cross-validation is similar:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/cv.ncvreg.html">cv.ncvsurv</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'cve'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'rsq'</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/models-cox-cv-1.png" width="480"></p>
<p>In addition to the quantities like coefficients and number of nonzero
coefficients that <code>predict</code> returns for other types of
models, <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> for an <code>ncvsurv</code> object can
also estimate the baseline hazard (using the Kalbfleish-Prentice method)
and therefore, the survival function. A method to plot the resulting
function is also available:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">'survival'</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="fu">S</span><span class="op">(</span><span class="fl">365</span><span class="op">)</span>   <span class="co"># Estiamted survival at 1 year</span></span>
<span><span class="co"># [1] 0.8594485</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/models-cox-surv-single-1.png" width="480"></p>
<p>When multiple subjects are involved in the prediction:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">X</span>, type<span class="op">=</span><span class="st">'survival'</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="va">S</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fl">365</span><span class="op">)</span>  <span class="co"># Estimated survival at 1 year for subject 1</span></span>
<span><span class="co"># [1] 0.8594485</span></span>
<span><span class="va">S</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fl">365</span><span class="op">)</span>  <span class="co"># Estimated survival at 1 year for subject 2</span></span>
<span><span class="co"># [1] 0.8887079</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/models-cox-surv-multiple-1.png" width="480"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Patrick Breheny.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
