<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Models â€¢ ncvreg</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Models">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ncvreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.15.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ncvreg.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/models.html">Models</a></li>
    <li><a class="dropdown-item" href="../articles/penalties.html">Penalties</a></li>
    <li><a class="dropdown-item" href="../articles/adaptive-rescaling.html">Standardization and adaptive rescaling</a></li>
    <li><a class="dropdown-item" href="../articles/inference-mfdr.html">Inference: Marginal false discovery rates</a></li>
    <li><a class="dropdown-item" href="../articles/inference-local.html">Inference: Local mfdr</a></li>
    <li><a class="dropdown-item" href="../articles/other-cv-criteria.html">Other CV criteria</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/ncvreg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Models</h1>
                        <h4 data-toc-skip class="author">Patrick
Breheny</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/ncvreg/blob/master/vignettes/articles/models.rmd" class="external-link"><code>vignettes/articles/models.rmd</code></a></small>
      <div class="d-none name"><code>models.rmd</code></div>
    </div>

    
    
<p><code>ncvreg</code> fits models that fall into the penalized
likelihood framework. Rather than estimating <span class="math inline">\boldsymbol{\beta}</span> by maximizing the
likelihood, in this framework we estimate <span class="math inline">\boldsymbol{\beta}</span> by minimizing the
objective function</p>
<p><span class="math display"> Q(\boldsymbol{\beta}\,\vert\,\mathbf{X},
\mathbf{y}) =
\frac{1}{n}L(\boldsymbol{\beta}\,\vert\,\mathbf{X},\mathbf{y}) +
P_\lambda(\boldsymbol{\beta}), </span></p>
<p>where the loss function <span class="math inline">L(\boldsymbol{\beta}|\mathbf{X},\mathbf{y})</span>
is the deviance (<span class="math inline">-2</span> times the
log-likelihood), <span class="math inline">P_\lambda(\boldsymbol{\beta})</span> is the penalty,
and <span class="math inline">\lambda</span> is a regularization
parameter that controls the tradeoff between the two components. This
article describes the different loss models available in
<code>ncvreg</code>; see <a href="penalties.html">penalties</a> for more
information on the different penalties available.</p>
<div class="section level2">
<h2 id="gaussian-linear-regression">Gaussian (linear regression)<a class="anchor" aria-label="anchor" href="#gaussian-linear-regression"></a>
</h2>
<p>In linear regression, the loss function is simply the squared error
loss:</p>
<p><span class="math display">
L(\boldsymbol{\beta}\,\vert\,\mathbf{X},\mathbf{y}) =
\lVert\mathbf{y}-\mathbf{X}\boldsymbol{\beta}\rVert_2^2; </span></p>
<p>this loss is proportional to the deviance if the outcome <span class="math inline">\mathbf{y}</span> follows a normal distribution with
constant variance and mean given by <span class="math inline">\mathbf{X}\boldsymbol{\beta}</span>.</p>
<p>In the <code>Prostate</code> data packaged with <code>ncvreg</code>,
the response is the prostate specific antigen (PSA), measured on the log
scale, and follows an approximate normal distribution; see
<code><a href="../reference/Prostate.html">?Prostate</a></code> for more information on the data set. Loading
this data set into R,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Prostate</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Prostate</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Prostate</span><span class="op">$</span><span class="va">y</span></span></code></pre></div>
<p>By default, <code>ncvreg</code> fits a linear regression model with a
minimax concave penalty (MCP):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>This produces a path of coefficient estimates, which we can plot
with</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/fit-linear-1.png" width="480"></p>
<p>Although the least squares loss function is convex, the MCP penalty
is not. The resulting objective function, therefore, may or may not be
convex. <code>ncvreg</code> uses a local convexity diagnostic, as
described in <a href="https://myweb.uiowa.edu/pbreheny/pdf/Breheny2011.pdf" class="external-link">Breheny and
Huang (2011)</a>, to identify the regions of the coefficient path where
the objective function is not convex; this is the gray shaded region in
the plot. Users should be aware that solutions in this region may only
be local optima of the objective function, not global ones.</p>
<p>Post-selection inference is available using the <code>summary</code>
method:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At lambda=0.0500:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   6</span></span>
<span><span class="co">#   Expected nonzero coefficients:   2.54</span></span>
<span><span class="co">#   Average mfdr (6 features)    :   0.424</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#         Estimate      z     mfdr Selected</span></span>
<span><span class="co"># lcavol   0.53179  8.880  &lt; 1e-04        *</span></span>
<span><span class="co"># svi      0.67256  3.945 0.010189        *</span></span>
<span><span class="co"># lweight  0.60390  3.666 0.027894        *</span></span>
<span><span class="co"># lbph     0.08875  1.928 0.773014        *</span></span>
<span><span class="co"># age     -0.01531 -1.788 0.815269        *</span></span>
<span><span class="co"># pgg45    0.00168  1.160 0.917570        *</span></span></code></pre></div>
<p>The local marginal false discovery rate (mfdr) is given for each of
the selected features. Roughly, this corresponds to the probability that
the given feature is marginally independent of the residuals at that
value of <span class="math inline">\lambda</span>. In this case, it
would appear that <code>lcavol</code>, <code>svi</code>, and
<code>lweight</code> are clearly associated with the response, even
after adjusting for the other variables in the model, while
<code>lbph</code>, <code>age</code>, and <code>pgg45</code> may be false
positives selected simply by chance. For more information on
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and its various options, see <a href="inference-local.html">here</a>.</p>
<p>Typically, one would carry out cross-validation for the purposes of
assessing the predictive accuracy of the model at various values of
<span class="math inline">\lambda</span>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.ncvreg.html">cv.ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>By default, the cross-validation error (CV) is plotted; for all
models in <code>ncvreg</code>, the cross-validation error is defined
as</p>
<p><span class="math display"> \begin{align*}
\textrm{CV}(\lambda) &amp;= \frac{1}{n} \sum_i L\{y_i,
\eta_{-i}(\lambda)\}\\
\eta_{-i}(\lambda) &amp;= \sum_j x_{ij}\widehat{\beta}_j(-i,\lambda),
\end{align*} </span></p>
<p>where <span class="math inline">\widehat{\boldsymbol{\beta}}(-i,\lambda)</span>
denotes the estimated regression coefficients at <span class="math inline">\lambda</span> for the fold in which observation
<span class="math inline">i</span> has been left out. The loss function
is determined by the type of model; for least squares loss,
therefore,</p>
<p><span class="math display"> \textrm{CV}(\lambda) = \frac{1}{n}
\sum_i\{y_i-\eta_{-i}(\lambda)\}^2. </span></p>
<p>Alternatively, one can plot <span class="math inline">\hat{\sigma}(\lambda)</span>, the signal-to-noise
ration (SNR), or <span class="math inline">R^2</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'cve'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'scale'</span><span class="op">)</span>  <span class="co"># sigma hat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'snr'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'rsq'</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<p>Calling <code>summary</code> on a <code>cv.ncvreg</code> object will
provide a summary of these quantities at the value which minimizes <span class="math inline">\textrm{CV}</span>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At minimum cross-validation error (lambda=0.0104):</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients: 8</span></span>
<span><span class="co">#   Cross-validation error (deviance): 0.59</span></span>
<span><span class="co">#   R-squared: 0.55</span></span>
<span><span class="co">#   Signal-to-noise ratio: 1.22</span></span>
<span><span class="co">#   Scale estimate (sigma): 0.771</span></span></code></pre></div>
<p>To access the elements of the fit, <code>coef</code> and
<code>predict</code> methods are provided. For example,
<code>coef(fit, lambda=0.02)</code> returns the estimated coefficients
at <span class="math inline">\lambda</span>=0.02, while
<code>coef(cvfit)</code> returns the estimated coefficients at the value
of <span class="math inline">\lambda</span> minimizing CV.</p>
</div>
<div class="section level2">
<h2 id="binomial-logistic-regression">Binomial (logistic regression)<a class="anchor" aria-label="anchor" href="#binomial-logistic-regression"></a>
</h2>
<p>In logistic regression, the loss function is: <span class="math display">
L(\boldsymbol{\beta}|\mathbf{X},\mathbf{y}) =
-2\sum_{i:y_i=1}\log\hat{\pi}_i - 2\sum_{i:y_i=0}\log(1-\hat{\pi}_i);
</span> this loss is the deviance for a binomial distribution with
probabilities <span class="math inline">P(Y_i=1)=\hat{\pi}_i</span>
given by: <span class="math display">
\hat{\pi}_i = \frac{\exp(\eta_i)}{1+\eta_i},
</span> where <span class="math inline">\boldsymbol{\eta}=
\mathbf{X}\boldsymbol{\beta}</span> denotes the linear predictors. The
<code>Heart</code> data provides an example of data that can be used
with logistic regression. Loading this data set into R,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Heart</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Heart</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Heart</span><span class="op">$</span><span class="va">y</span></span></code></pre></div>
<p>One can change the loss function by specifying <code>family</code>;
to fit a penalized logistic regression model,</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, family<span class="op">=</span><span class="st">'binomial'</span><span class="op">)</span></span></code></pre></div>
<p>As before, you can call <code>plot</code>, <code>coef</code>,
<code>predict</code>, <code>summary</code>, etc. on
<code>fit</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized logistic regression with n=462, p=9</span></span>
<span><span class="co"># At lambda=0.0200:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   7</span></span>
<span><span class="co">#   Expected nonzero coefficients:   1.90</span></span>
<span><span class="co">#   Average mfdr (7 features)    :   0.271</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#           Estimate       z      mfdr Selected</span></span>
<span><span class="co"># age      0.0506911  5.8368   &lt; 1e-04        *</span></span>
<span><span class="co"># famhist  0.9096673  4.1177 0.0024258        *</span></span>
<span><span class="co"># tobacco  0.0802204  3.3117 0.0443510        *</span></span>
<span><span class="co"># typea    0.0370468  3.1833 0.0656364        *</span></span>
<span><span class="co"># ldl      0.1657752  3.1019 0.0831088        *</span></span>
<span><span class="co"># obesity -0.0087180 -1.2579 0.8340700        *</span></span>
<span><span class="co"># sbp      0.0001648  0.9981 0.8707837        *</span></span></code></pre></div>
<p>Cross-validation is similar, although (a) there is a new option,
<code>type='pred'</code> for cross-validated prediction error
(misclassification error) and (b) <code>type='scale'</code> is no longer
an option:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.ncvreg.html">cv.ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, family<span class="op">=</span><span class="st">'binomial'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'all'</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-11-1.png" width="480"></p>
<p>Note that, as defined above, cross-validation error is the
cross-validated deviance. At its optmium, the penalized logistic
regression model can predict about 73% of coronary heart disease cases
correctly (27% misclassification).</p>
</div>
<div class="section level2">
<h2 id="poisson">Poisson<a class="anchor" aria-label="anchor" href="#poisson"></a>
</h2>
<p>In Poisson regression, the loss function is: <span class="math display">
L(\boldsymbol{\beta}|\mathbf{X},\mathbf{y}) = 2\sum_i \left\{y_i\log y_i
- y_i\log \mu_i + mu_i - y_i\right\};
</span> note that some of these terms are constant with respect to <span class="math inline">\mu_i</span> and can therefore be ignored during
optimization. This loss is the deviance for a Poisson distribution <span class="math inline">Y_i \sim \text{Pois}(\hat{\mu}_i)</span> with rate
parameter given by: <span class="math display">
\hat{\mu}_i = \exp(\eta_i).
</span> To fit a penalized Poisson regression model with
<code>ncvreg</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, family<span class="op">=</span><span class="st">'poisson'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cox-proportional-hazards">Cox proportional hazards<a class="anchor" aria-label="anchor" href="#cox-proportional-hazards"></a>
</h2>
<p>The above models all fall into the category of distributions known as
exponential families (hence the <code>family</code>) argument.
<code>ncvreg</code> also allows users to fit Cox proportional hazards
models, although these models fall outside this framework and are
therefore fit using a different function, <code>ncvsurv</code>. In Cox
regression, the deviance is <span class="math display">
L(\boldsymbol{\beta}|\mathbf{X},\mathbf{y}) = -2\sum_{j=1}^{m} d_j
\eta_j + 2\sum_{j=1}^{m} d_j \log\left\{\sum_{i \in R_j}
\exp(\eta_i)\right\},
</span> where <span class="math inline">t_1 &lt; t_2 &lt; \ldots &lt;
t_m</span> denotes an increasing list of unique failure times indexed by
<span class="math inline">j</span> and <span class="math inline">R_j</span> denotes the set of observations still at
risk at time <span class="math inline">t_j</span>, known as the risk
set.</p>
<p>The <code>Lung</code> data (see <code><a href="../reference/Lung.html">?Lung</a></code> for more details)
provides an example of time-to-event data that can be used with Cox
regression. Loading this data set into R,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Lung</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Lung</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Lung</span><span class="op">$</span><span class="va">y</span></span></code></pre></div>
<p>To fit a penalized Cox regression model,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncvsurv.html">ncvsurv</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>As before, you can call <code>plot</code>, <code>coef</code>,
<code>predict</code>, <code>summary</code>, etc. on
<code>fit</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized Cox regression with n=137, p=8</span></span>
<span><span class="co"># At lambda=0.0200:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   7</span></span>
<span><span class="co">#   Expected nonzero coefficients:   4.59</span></span>
<span><span class="co">#   Average mfdr (7 features)    :   0.656</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#           Estimate       z     mfdr Selected</span></span>
<span><span class="co"># karno    -0.032745 -6.5040  &lt; 1e-04        *</span></span>
<span><span class="co"># squamous -0.853399 -3.7843 0.026061        *</span></span>
<span><span class="co"># large    -0.460405 -2.0522 0.806970        *</span></span>
<span><span class="co"># trt       0.294489  1.5967 0.905628        *</span></span>
<span><span class="co"># adeno     0.324743  1.3941 0.928532        *</span></span>
<span><span class="co"># age      -0.008869 -1.0297 0.952846        *</span></span>
<span><span class="co"># prior     0.033326  0.3585 0.969878        *</span></span></code></pre></div>
<p>Cross-validation is similar:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.ncvreg.html">cv.ncvsurv</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'cve'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">'rsq'</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/models-cox-cv-1.png" width="480"></p>
<p>In addition to the quantities like coefficients and number of nonzero
coefficients that <code>predict</code> returns for other types of
models, <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> for an <code>ncvsurv</code> object can
also estimate the baseline hazard (using the Kalbfleish-Prentice method)
and therefore, the survival function. A method to plot the resulting
function is also available:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">'survival'</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="fu">S</span><span class="op">(</span><span class="fl">365</span><span class="op">)</span>   <span class="co"># Estiamted survival at 1 year</span></span>
<span><span class="co"># [1] 0.8594485</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/models-cox-surv-single-1.png" width="480"></p>
<p>When multiple subjects are involved in the prediction:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">X</span>, type<span class="op">=</span><span class="st">'survival'</span>, lambda<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="va">S</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fl">365</span><span class="op">)</span>  <span class="co"># Estimated survival at 1 year for subject 1</span></span>
<span><span class="co"># [1] 0.8594485</span></span>
<span><span class="va">S</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fl">365</span><span class="op">)</span>  <span class="co"># Estimated survival at 1 year for subject 2</span></span>
<span><span class="co"># [1] 0.8887079</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="models_files/figure-html/models-cox-surv-multiple-1.png" width="480"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Breheny, Ryan Miller, Logan Harris.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Last updated: July 24, 2025</p>
</div>

    </footer>
</div>





  </body>
</html>
