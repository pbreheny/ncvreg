<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with ncvreg • ncvreg</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Getting started with ncvreg">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ncvreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.15.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/web/getting-started.html">Getting started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn more</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-more">
<li><a class="dropdown-item" href="../articles/web/models.html">Models</a></li>
    <li><a class="dropdown-item" href="../articles/web/penalties.html">Penalties</a></li>
    <li><a class="dropdown-item" href="../articles/web/adaptive-rescaling.html">Standardization</a></li>
    <li><a class="dropdown-item" href="../articles/web/inference-mfdr.html">Inference: Marginal false discovery rates</a></li>
    <li><a class="dropdown-item" href="../articles/web/inference-local.html">Inference: Local mfdr</a></li>
    <li><a class="dropdown-item" href="../articles/web/other-cv-criteria.html">Other CV criteria</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/ncvreg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with ncvreg</h1>
                        <h4 data-toc-skip class="author">Patrick
Breheny</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/ncvreg/blob/master/vignettes/getting-started.rmd" class="external-link"><code>vignettes/getting-started.rmd</code></a></small>
      <div class="d-none name"><code>getting-started.rmd</code></div>
    </div>

    
    
<p><code>ncvreg</code> is an R package for fitting regularization paths
for linear regression, GLM, and Cox regression models using lasso or
nonconvex penalties, in particular the minimax concave penalty (MCP) and
smoothly clipped absolute deviation (SCAD) penalty, with options for
additional L<sub>2</sub> penalties (the “elastic net” idea). Utilities
for carrying out cross-validation as well as post-fitting visualization,
summarization, inference, and prediction are also provided.</p>
<p>This vignette offers a brief introduction to the basic use of
<code>ncvreg</code>. For more details on the package, visit the
<code>ncvreg</code> website at <a href="https://pbreheny.github.io/ncvreg/" class="uri">https://pbreheny.github.io/ncvreg/</a> and follow the links
under “Learn more”. For more on the algorithms used by
<code>ncvreg</code>, see the original article:</p>
<ul>
<li><a href="https://myweb.uiowa.edu/pbreheny/pdf/Breheny2011.pdf" class="external-link">Breheny P
and Huang J (2011). Coordinate descent algorithms for nonconvex
penalized regression, with applications to biological feature selection.
<em>Annals of Applied Statistics</em>, 5: 232–253</a></li>
</ul>
<p>For more about the marginal false discovery rate idea used for
post-selection inference, see</p>
<ul>
<li><a href="https://dx.doi.org/10.1093/biostatistics/kxy004" class="external-link">Breheny P
(2019). Marginal false discovery rates for penalized regression models.
<em>Biostatistics</em>, <strong>20</strong>: 299-314</a></li>
</ul>
<p><code>ncvreg</code> comes with a few example data sets; we’ll look at
<code>Prostate</code>, which has 8 features and one continuous response,
the PSA levels (on the log scale) from men about to undergo radical
prostatectomy:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Prostate</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Prostate</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Prostate</span><span class="op">$</span><span class="va">y</span></span></code></pre></div>
<p>To fit a penalized regression model to this data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncvreg.html">ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>The default penalty here is the minimax concave penalty (MCP), but
SCAD and lasso penalties are also available. This produces a path of
coefficients, which we can plot with</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/plot-1.png" width="480"></p>
<p>Notice that variables enter the model one at a time, and that at any
given value of <span class="math inline">\lambda</span>, several
coefficients are zero. To see what the coefficients are, we could use
the <code>coef</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co"># (Intercept)      lcavol     lweight         age        lbph         svi </span></span>
<span><span class="co">#  0.35121089  0.53178994  0.60389694 -0.01530917  0.08874563  0.67256096 </span></span>
<span><span class="co">#         lcp     gleason       pgg45 </span></span>
<span><span class="co">#  0.00000000  0.00000000  0.00168038</span></span></code></pre></div>
<p>The <code>summary</code> method can be used for post-selection
inference:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, lambda<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At lambda=0.0500:</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients         :   6</span></span>
<span><span class="co">#   Expected nonzero coefficients:   2.54</span></span>
<span><span class="co">#   Average mfdr (6 features)    :   0.424</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#         Estimate      z     mfdr Selected</span></span>
<span><span class="co"># lcavol   0.53179  8.880  &lt; 1e-04        *</span></span>
<span><span class="co"># svi      0.67256  3.945 0.010189        *</span></span>
<span><span class="co"># lweight  0.60390  3.666 0.027894        *</span></span>
<span><span class="co"># lbph     0.08875  1.928 0.773014        *</span></span>
<span><span class="co"># age     -0.01531 -1.788 0.815269        *</span></span>
<span><span class="co"># pgg45    0.00168  1.160 0.917570        *</span></span></code></pre></div>
<p>In this case, it would appear that <code>lcavol</code>,
<code>svi</code>, and <code>lweight</code> are clearly associated with
the response, even after adjusting for the other variables in the model,
while <code>lbph</code>, <code>age</code>, and <code>pgg45</code> may be
false positives included simply by chance.</p>
<p>Typically, one would carry out cross-validation for the purposes of
assessing the predictive accuracy of the model at various values of
<span class="math inline">\lambda</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.ncvreg.html">cv.ncvreg</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span>
<span><span class="co"># MCP-penalized linear regression with n=97, p=8</span></span>
<span><span class="co"># At minimum cross-validation error (lambda=0.0169):</span></span>
<span><span class="co"># -------------------------------------------------</span></span>
<span><span class="co">#   Nonzero coefficients: 7</span></span>
<span><span class="co">#   Cross-validation error (deviance): 0.55</span></span>
<span><span class="co">#   R-squared: 0.59</span></span>
<span><span class="co">#   Signal-to-noise ratio: 1.42</span></span>
<span><span class="co">#   Scale estimate (sigma): 0.739</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/cvplot-1.png" width="480"></p>
<p>The value of <span class="math inline">\lambda</span> that minimizes
the cross-validation error is given by <code>cvfit$lambda.min</code>,
which in this case is 0.017. Applying <code>coef</code> to the output of
<code>cv.ncvreg</code> returns the coefficients at that value of <span class="math inline">\lambda</span>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span>
<span><span class="co">#  (Intercept)       lcavol      lweight          age         lbph          svi </span></span>
<span><span class="co">#  0.494154801  0.569546027  0.614419811 -0.020913467  0.097352536  0.752397339 </span></span>
<span><span class="co">#          lcp      gleason        pgg45 </span></span>
<span><span class="co"># -0.104959403  0.000000000  0.005324465</span></span></code></pre></div>
<p>Predicted values can be obtained via <code>predict</code>, which has
a number of options:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cvfit</span>, X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>     <span class="co"># Prediction of response for new observations</span></span>
<span><span class="co">#         1         2         3         4         5         6 </span></span>
<span><span class="co"># 0.8304040 0.7650906 0.4262072 0.6230117 1.7449492 0.8449595</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">"nvars"</span><span class="op">)</span>  <span class="co"># Number of nonzero coefficients</span></span>
<span><span class="co"># 0.01695 </span></span>
<span><span class="co">#       7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cvfit</span>, type<span class="op">=</span><span class="st">"vars"</span><span class="op">)</span>   <span class="co"># Identity of the nonzero coefficients</span></span>
<span><span class="co">#  lcavol lweight     age    lbph     svi     lcp   pgg45 </span></span>
<span><span class="co">#       1       2       3       4       5       6       8</span></span></code></pre></div>
<p>Note that the original fit (to the full data set) is returned as
<code>cvfit$fit</code>; it is not necessary to call both
<code>ncvreg</code> and <code>cv.ncvreg</code> to analyze a data set.
For example, <code>plot(cvfit$fit)</code> will produce the same
coefficient path plot as <code>plot(fit)</code> above.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Breheny, Ryan Miller, Logan Harris.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
